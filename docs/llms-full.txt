# Montra API Reference (v1)
This document provides a comprehensive overview of the Montra API, designed for both developers and AI agents.

## Base URL
The API is available at `https://dev.montra.fi/api/v1`

## Authentication
All API requests must include an API key in the `Authorization` header as a Bearer token.
```
Authorization: Bearer <your_api_key>
```

---

## Customers
Manage billing profiles for your users.

### List Customers
`GET /customers`
Retrieve all customers for your merchant.

### Create Customer
`POST /customers`
Payload:
- `name`: string (required)
- `email`: string (required)
- `phone`: string (optional)
- `address`: object (optional)

---

## Usage & Metering
Report events to track consumption for usage-based billing.

### Report Usage
`POST /usage`
Payload:
- `customer_id`: string (required)
- `meter_slug`: string (required)
- `amount`: number (default: 1)
- `metadata`: object (optional)

### Manage Meters
`GET /meters` - List all meters.
`POST /meters` - Create a new meter.

---

## Pricing Models
Manage plan structures and propagation rules.

### List Models
`GET /pricing-models`

### Create Model
`POST /pricing-models`
Payload:
- `name`: string (required)
- `is_default`: boolean (optional)

### Update Model (Live Propagation)
`PATCH /pricing-models`
Changes to a model immediately propagate to all assigned customers.

---

## Entitlements
Check if a customer is allowed to access specific features or has remaining quota.

### Check Entitlement
`GET /entitlements?customer_id=<id>&meter=<slug>&feature=<slug>`
One of `meter` or `feature` must be provided.

---

## Checkout & Links
Programmatically generate payment flows.

### Create Checkout Link
`POST /checkout-links`
Payload:
- `link_name`: string (required)
- `line_items`: array (optional, for multi-item checkouts)
- `image_ids`: array (optional, internal IDs or external URLs)
- `amount`: number (optional)
- `payment_name`: string (required)

---

## Subscriptions
Manage recurring billing relationships.

### List Subscriptions
`GET /subscriptions`
Filters: `customer_id`, `status` (active, past_due, canceled).

### Upgrade (Prorated)
`POST /subscriptions/{id}/upgrade`
Immediately move a customer to a new plan.

### Schedule Change
`POST /subscriptions/{id}/scheduled-changes`
Schedule a plan change for a future date.

### Pause / Resume
`POST /subscriptions/{id}/pause`
`POST /subscriptions/{id}/resume`

---

## Commerce Operations
Handle reversals and incentives.

### Create Refund
`POST /refunds`
Payload:
- `transaction_id`: string (required)
- `amount`: number (required)
- `reason`: string (optional)

### Create Discount
`POST /discounts`
Payload:
- `name`: string (required)
- `code`: string (required)
- `percent_off`: number (optional)
- `amount_off`: number (optional)
- `duration`: 'once' | 'repeating' | 'forever'

---

## Webhooks
Configure endpoints to receive real-time notifications.

### Manage Endpoints
`GET /webhooks` - List all endpoints.
`POST /webhooks` - Create a new endpoint.
`PATCH /webhooks/{id}` - Update endpoint.
`DELETE /webhooks/{id}` - Remove endpoint.

---

## Audit Logs
Access merchant event history.

### List Logs
`GET /audit-logs`
Filters: `event_type`, `resource_type`.
Pagination: `limit`, `offset`.